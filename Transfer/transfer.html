<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Check ERC20 Balance</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.6.2/dist/ethers.umd.min.js"></script>
</head>
<body>
  <h1>ERC20 Balance Checker (Holesky)</h1>
  <button id="checkBalance">Check My Token Balance</button>
  <p id="output">Click the button to see your ERC20 token balance.</p>

  <script>
    const contractAddress = "0xDd213AaC5060d47A70D2f37Ff4b53d9DB6c7fb62"; // ⬅️ Replace with your actual contract
    const erc20ABI = [
      "function balanceOf(address account) view returns (uint256)"
    ];

    const output = document.getElementById("output");

    // MetaMask-specific provider getter (avoids Phantom)
    function getMetaMaskProvider() {
      if (window.ethereum?.providers) {
        return window.ethereum.providers.find(p => p.isMetaMask);
      }
      if (window.ethereum?.isMetaMask) {
        return window.ethereum;
      }
      return null;
    }

    document.getElementById("checkBalance").addEventListener("click", async () => {
      const metamask = getMetaMaskProvider();

      if (!metamask) {
        output.innerText = "MetaMask not found. Please disable Phantom or use a MetaMask-only browser profile.";
        return;
      }

      try {
        // Request access to MetaMask
        await metamask.request({ method: "eth_requestAccounts" });

        const provider = new ethers.BrowserProvider(metamask);
        const signer = await provider.getSigner();
        const userAddress = await signer.getAddress();

        // Connect to ERC20 contract
        const contract = new ethers.Contract(contractAddress, erc20ABI, provider);
        const rawBalance = await contract.balanceOf(userAddress);
        const balance = ethers.formatUnits(rawBalance, 18); // Assumes token uses 18 decimals

        output.innerText = `Your ERC20 Token Balance: ${balance}`;
      } catch (error) {
        console.error(error);
        output.innerText = "Error: " + error.message;
      }
    });
  </script>
</body>
</html>
